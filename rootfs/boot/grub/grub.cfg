# ============================================================
# aiOS GRUB Boot Configuration
# ============================================================
# Installed-system bootloader configuration.
# Root device uses /dev/vda2 (virtio disk, partition 2).
# Serial console enabled for headless/VM operation.
# ============================================================

set timeout=3
set default=0

# Serial console configuration for headless/VM operation
serial --speed=115200 --unit=0 --word=8 --parity=no --stop=1
terminal_input serial console
terminal_output serial console

# -------------------------------------------------------
# Default boot entry: aiOS
# -------------------------------------------------------
menuentry "aiOS" {
    echo "Loading aiOS kernel..."
    linux /boot/vmlinuz root=/dev/vda2 ro console=ttyS0,115200 console=tty0 init=/usr/sbin/aios-init quiet loglevel=3
    echo "Loading initramfs..."
    initrd /boot/initramfs.img
}

# -------------------------------------------------------
# Recovery entry: verbose logging, recovery flag
# -------------------------------------------------------
menuentry "aiOS (Recovery)" {
    echo "Loading aiOS kernel in recovery mode..."
    linux /boot/vmlinuz root=/dev/vda2 ro console=ttyS0,115200 console=tty0 init=/usr/sbin/aios-init aios.recovery=1 loglevel=7
    echo "Loading initramfs..."
    initrd /boot/initramfs.img
}

# -------------------------------------------------------
# Debug shell: bypass aios-init, drop to /bin/sh
# -------------------------------------------------------
menuentry "aiOS (Debug Shell)" {
    echo "Loading kernel with debug shell..."
    linux /boot/vmlinuz root=/dev/vda2 ro console=ttyS0,115200 console=tty0 init=/bin/sh loglevel=7
    echo "Loading initramfs..."
    initrd /boot/initramfs.img
}
